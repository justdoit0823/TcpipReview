TCP连接的监听队列
=================

	TCP在接受来自远端的连接时，会先通过三次握手把连接建立起来，并维护在监听队列里面，等到套接字层的accept调用来取。当然，TCP会为每个
	本地的监听套接字设定一个队列长度(即平时所说的积压值)。这里会有一个算法来判断真实要建立连接的个数(长度),具体应该跟实现有关。


python的套接字实现模拟
======================

客户端连接的实现
----------------

	import socket

	client1 = socket.socket()
	client1.connect(('', 999))


服务端处理连接的实现
--------------------

	import socket

	server = socket.socket()
	server.bind(('', 9999))
	server.listen(5)
	client, addr = server.accept()


TCP协议栈的表现
===============

	具体抓包结果如下:

	* 7	2015-04-19 22:35:32.940247000	127.0.0.1	127.0.0.1	TCP	74	35032 > distinct [SYN] Seq=0 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10313838 TSecr=0 WS=128
	* 8	2015-04-19 22:35:32.940271000	127.0.0.1	127.0.0.1	TCP	74	distinct > 35032 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10313838 TSecr=10313838 WS=128
	* 9	2015-04-19 22:35:32.940289000	127.0.0.1	127.0.0.1	TCP	66	35032 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10313838 TSecr=10313838
	* 16	2015-04-19 22:35:54.482229000	127.0.0.1	127.0.0.1	TCP	74	35033 > distinct [SYN] Seq=0 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10319224 TSecr=0 WS=128
	* 17	2015-04-19 22:35:54.482253000	127.0.0.1	127.0.0.1	TCP	74	distinct > 35033 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10319224 TSecr=10319224 WS=128
	* 18	2015-04-19 22:35:54.482270000	127.0.0.1	127.0.0.1	TCP	66	35033 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10319224 TSecr=10319224
	* 42	2015-04-19 22:36:35.986726000	127.0.0.1	127.0.0.1	TCP	74	35035 > distinct [SYN] Seq=0 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10329600 TSecr=0 WS=128
	* 43	2015-04-19 22:36:35.986750000	127.0.0.1	127.0.0.1	TCP	74	distinct > 35035 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10329600 TSecr=10329600 WS=128
	* 44	2015-04-19 22:36:35.986768000	127.0.0.1	127.0.0.1	TCP	66	35035 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10329600 TSecr=10329600
	* 59	2015-04-19 22:36:46.906649000	127.0.0.1	127.0.0.1	TCP	74	35039 > distinct [SYN] Seq=0 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10332330 TSecr=0 WS=128
	* 60	2015-04-19 22:36:46.906692000	127.0.0.1	127.0.0.1	TCP	74	distinct > 35039 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10332330 TSecr=10332330 WS=128
	* 61	2015-04-19 22:36:46.906706000	127.0.0.1	127.0.0.1	TCP	66	35039 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10332330 TSecr=10332330
	* 62	2015-04-19 22:36:58.222261000	127.0.0.1	127.0.0.1	TCP	74	35040 > distinct [SYN] Seq=0 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10335159 TSecr=0 WS=128
	* 63	2015-04-19 22:36:58.222288000	127.0.0.1	127.0.0.1	TCP	74	distinct > 35040 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10335159 TSecr=10335159 WS=128
	* 64	2015-04-19 22:36:58.222310000	127.0.0.1	127.0.0.1	TCP	66	35040 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10335159 TSecr=10335159
	* 77	2015-04-19 22:37:23.711150000	127.0.0.1	127.0.0.1	TCP	74	35041 > distinct [SYN] Seq=0 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10341531 TSecr=0 WS=128
	* 78	2015-04-19 22:37:23.711190000	127.0.0.1	127.0.0.1	TCP	74	distinct > 35041 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10341531 TSecr=10341531 WS=128
	* 79	2015-04-19 22:37:23.711207000	127.0.0.1	127.0.0.1	TCP	66	35041 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10341531 TSecr=10341531
	<!-- * 86	2015-04-19 22:37:47.380819000	127.0.0.1	127.0.0.1	TCP	74	35042 > distinct [SYN] Seq=0 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10347448 TSecr=0 WS=128 -->
	<!-- * 87	2015-04-19 22:37:47.380872000	127.0.0.1	127.0.0.1	TCP	74	distinct > 35042 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10347448 TSecr=10347448 WS=128 -->
	<!-- * 88	2015-04-19 22:37:47.380914000	127.0.0.1	127.0.0.1	TCP	66	35042 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10347448 TSecr=10347448 -->
	<!-- * 89	2015-04-19 22:37:48.577977000	127.0.0.1	127.0.0.1	TCP	74	[TCP Retransmission] distinct > 35042 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10347748 TSecr=10347448 WS=128 -->
	<!-- * 90	2015-04-19 22:37:48.578041000	127.0.0.1	127.0.0.1	TCP	66	[TCP Dup ACK 88#1] 35042 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10347748 TSecr=10347448 -->
	<!-- * 91	2015-04-19 22:37:50.577966000	127.0.0.1	127.0.0.1	TCP	74	[TCP Retransmission] distinct > 35042 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10348248 TSecr=10347748 WS=128 -->
	<!-- * 92	2015-04-19 22:37:50.578012000	127.0.0.1	127.0.0.1	TCP	66	[TCP Dup ACK 88#2] 35042 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10348248 TSecr=10347448 -->
	<!-- * 93	2015-04-19 22:37:54.978003000	127.0.0.1	127.0.0.1	TCP	74	[TCP Retransmission] distinct > 35042 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10349348 TSecr=10348248 WS=128 -->
	<!-- * 94	2015-04-19 22:37:54.978064000	127.0.0.1	127.0.0.1	TCP	66	[TCP Dup ACK 88#3] 35042 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10349348 TSecr=10347448 -->
	<!-- * 107	2015-04-19 22:38:02.978014000	127.0.0.1	127.0.0.1	TCP	74	[TCP Retransmission] distinct > 35042 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10351348 TSecr=10351347 WS=128 -->
	<!-- * 115	2015-04-19 22:38:18.977987000	127.0.0.1	127.0.0.1	TCP	74	[TCP Retransmission] distinct > 35042 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10355348 TSecr=10354568 WS=128 -->
	* 371	2015-04-19 22:49:36.294452000	127.0.0.1	127.0.0.1	TCP	74	35064 > distinct [SYN] Seq=0 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10524677 TSecr=0 WS=128
	* 372	2015-04-19 22:49:36.294509000	127.0.0.1	127.0.0.1	TCP	74	distinct > 35064 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10524677 TSecr=10524677 WS=128
	* 373	2015-04-19 22:49:36.294553000	127.0.0.1	127.0.0.1	TCP	66	35064 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10524677 TSecr=10524677
	* 374	2015-04-19 22:49:37.693988000	127.0.0.1	127.0.0.1	TCP	74	[TCP Retransmission] distinct > 35064 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10525027 TSecr=10524677 WS=128
	* 375	2015-04-19 22:49:37.694049000	127.0.0.1	127.0.0.1	TCP	66	[TCP Dup ACK 373#1] 35064 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10525027 TSecr=10524677
	* 382	2015-04-19 22:49:39.894025000	127.0.0.1	127.0.0.1	TCP	74	[TCP Retransmission] distinct > 35064 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10525577 TSecr=10525027 WS=128
	* 383	2015-04-19 22:49:39.894121000	127.0.0.1	127.0.0.1	TCP	66	[TCP Dup ACK 373#2] 35064 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10525577 TSecr=10524677
	* 384	2015-04-19 22:49:44.093914000	127.0.0.1	127.0.0.1	TCP	74	[TCP Retransmission] distinct > 35064 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10526627 TSecr=10525577 WS=128
	* 385	2015-04-19 22:49:44.093930000	127.0.0.1	127.0.0.1	TCP	66	[TCP Dup ACK 373#3] 35064 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10526627 TSecr=10524677
	* 386	2015-04-19 22:49:52.094021000	127.0.0.1	127.0.0.1	TCP	74	[TCP Retransmission] distinct > 35064 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10528627 TSecr=10526627 WS=128
	* 387	2015-04-19 22:49:52.094124000	127.0.0.1	127.0.0.1	TCP	66	[TCP Dup ACK 373#4] 35064 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10528627 TSecr=10524677
	* 394	2015-04-19 22:50:08.093964000	127.0.0.1	127.0.0.1	TCP	74	[TCP Retransmission] distinct > 35064 [SYN, ACK] Seq=0 Ack=1 Win=43690 Len=0 MSS=65495 SACK_PERM=1 TSval=10532627 TSecr=10528627 WS=128
	* 395	2015-04-19 22:50:08.094029000	127.0.0.1	127.0.0.1	TCP	66	[TCP Dup ACK 373#5] 35064 > distinct [ACK] Seq=1 Ack=1 Win=43776 Len=0 TSval=10532627 TSecr=10524677
	* 667	2015-04-19 22:57:31.967939000	127.0.0.1	127.0.0.1	TCP	70	35064 > distinct [PSH, ACK] Seq=1 Ack=1 Win=43776 Len=4 TSval=10643595 TSecr=10524677
	* 668	2015-04-19 22:57:31.967986000	127.0.0.1	127.0.0.1	TCP	54	distinct > 35064 [RST] Seq=1 Win=0 Len=0

	从上面可以看出，当处理完6个连接之后就会出现一些不一样的现象了。虽然三次握手的正常确认收到了，但是如果超过监听队列的限制时，三次握手中的第二个ACK会被丢掉的，从而引起服务端的重传(5次)。
	如果5次之后还是队列还是满的话，该连接会被丢掉的，后续的对此套接字的写操作会引发RST响应。通过程序，还会看到的是如果在5次之内队列还能放下连接的话，则该连接不会被放弃而是放入队列，如正常连接一样。
	还有一点，对套接字进行写操作的成功并不能表示数据被对端正确接收了。如对35064端口的套接字进行写数据的话，应用程序会依然返回数据的长度，而TCP协议栈里面明显有RST响应，只能在下一次对该套接字进行操作时才能体现出来，
	或者是通过套接字(getsockopt)来查看错误。
